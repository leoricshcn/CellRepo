# 用户需求说明：Discord 任务管理机器人

## 1. 项目概述
- **目标**：为 Discord 服务器提供一个任务管理机器人，帮助团队以命令交互的方式创建与查看任务。
- **核心价值**：将任务指派与提醒流程集中在 Discord 内完成，提升团队协作效率。

## 2. 使用角色
- **任务创建者**：拥有执行 `/task` 命令权限的成员，通常为项目负责人或管理员。
- **任务执行者**：被指派任务的成员（命令参数中的 `@users` 列表）。
- **普通成员**：可执行 `/listask` 查询自己任务的成员。

## 3. 先决条件与假设
- 机器人已加入目标 Discord 服务器，并拥有读取与发送消息、创建帖子、使用应用命令等必要权限。
- 服务器中存在名为 `tasks` 的频道，且该频道支持创建帖子（Thread 或 Forum Channel）。
- 任务数据以 Discord 帖子为唯一可信来源，机器人可以读取历史帖子用于任务列表。

## 4. 功能需求
### FR1 `/task` 命令创建任务
- **命令格式**：`/task task_name:<字符串> due_date:<日期或日期时间> assignees:<用户列表>`。
- **执行流程**：
  1. 验证调用者权限，确保其可以在 `tasks` 频道创建帖子。
  2. 在 `tasks` 频道新建一个帖子，标题格式：`<task_name> | Due: <due_date>`。
  3. 在帖子正文中包含：
     - 任务名称与简要描述（若命令提供额外描述字段可扩展）。
     - 截止时间 `due_date` 的标准化展示（如 ISO 8601 或服务器本地时区格式）。
     - 自动 @ 提醒 `assignees` 中的每位成员。
  4. 创建成功后向调用者返回确认信息，包含帖子链接与被指派人员。
- **错误处理**：
  - 缺失任何必填参数时给予明确错误提示。
  - 若指定用户无法被 @（例如不在服务器内），记录并通知调用者。
  - 当频道不存在或机器人缺少权限时，提示管理员联系运维调整。

### FR2 `/listask` 命令列出任务
- **命令格式**：`/listask`（无额外参数，默认查看当前用户任务）。
- **执行流程**：
  1. 识别命令调用者的 Discord 用户 ID。
  2. 在 `tasks` 频道检索包含该用户 @ 的任务帖子。
  3. 将检索结果按以下顺序排序：
     - 先按截止时间 `due_date` 升序；
     - 若截止时间相同，则按帖子创建时间升序。
  4. 返回格式化列表给调用者，每条任务包含：
     - 帖子标题（即任务名称与截止时间）；
     - 创建时间；
     - 帖子链接；
     - 任务状态（可选，如根据帖子是否关闭或添加标签判断）。
- **无任务结果**：若调用者未被指派任何任务，返回友好提示并建议使用 `/task` 指派。

## 5. 非功能需求
- **可靠性**：机器人应在断线后自动重连，并确保命令响应成功率 ≥ 99%。
- **可用性**：命令响应时间应控制在 3 秒以内；若需要进行耗时数据检索，应反馈处理中状态。
- **安全性**：仅授权成员可调用 `/task`，`/listask` 仅返回调用者相关任务。

## 6. 配置与定制
- 可配置 `tasks` 频道 ID，以支持多服务器部署。
- 支持设置默认时区与日期格式，用于格式化 `due_date`。
- 允许自定义任务帖子模板（标题、正文样式等）。

## 7. 验收标准
- 成员执行 `/task` 后，在 `tasks` 频道成功生成包含任务标题、截止时间与 @ 指派成员的新帖子。
- 任一被指派成员执行 `/listask` 时，能看到按截止时间、创建时间排序的任务列表。
- 机器人在权限缺失或参数错误时提供明确提示，不出现静默失败。

## 8. 后续扩展建议
- 支持更新任务状态的命令（如 `/done` 标记完成）。
- 与外部任务管理工具同步（如 Jira、Trello）。
- 为任务添加标签、优先级或自动提醒。
